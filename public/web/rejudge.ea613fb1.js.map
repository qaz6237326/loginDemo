{"version":3,"sources":["webpack:///./modules/rejudge/index.js","webpack:///./constant/keyCode.js","webpack:///./modules/rejudge/containers/ImageInfo.js","webpack:///./modules/rejudge/containers/Export.js","webpack:///./modules/rejudge/containers/QueryCondition.js","webpack:///./modules/rejudge/containers/GlassList.js","webpack:///./modules/rejudge/containers/App.js"],"names":["_interopRequireDefault","__webpack_require__","App","F5","F6","_react","_reactRedux","_bere","_keyCode","reworkList","title","value","text","turnOnList","canBillList","objFormatting","objStr","obj","JSON","parse","list","Object","keys","forEach","key","push","join","ImageInfo","newCode","e","keyCode","preventDefault","_this","handlePrev","handleNext","image_url","props","image","confirm","shouldCloseOnOverlayClick","hasFooter","className","default","createElement","src","dispatch","type","payload","file","target","files","reader","FileReader","onload","codes","string","split","map","row","trim","filter","i","parseCodesCSV","result","readAsText","state","indexOf","TopTips","theme","message","concat","showResult","setState","callback","handleReturn","_this$props","isCodeLoading","isListLoading","hasChanged","_this$props2","curTab","React","Component","document","addEventListener","this","handleKeyDown","removeEventListener","_this$props3","page","imageList","image_name","image_path","adc_result","mes_result","rejudge_result","site","shop","operation","product","unrejudge","item","length","alt","onClick","ShowBigImg","PageLoading","Fragment","id","onChange","handleUploadFile","accept","RadioGroup","code","arr","radioListInit","handleRejudgeChange","Input","handleNewCodeChange","href","handleUpdateCode","rework","turn_on","canBilling","Checkbox","checked","label","handleShowResultChange","Button","handleSubmit","handleClear","_this$props4","oldImage","find","oldResult","connect","_ref","rejudge","_classnames","queue","Export","total","cur","loading","error","filters","pages","Math","ceil","_loop","Promise","resolve","reject","err","data","all","then","datas","link","apply","_toConsumableArray","values","replace","contentType","buffer","ArrayBuffer","array","Uint8Array","charCodeAt","Blob","toBlob","console","log","window","navigator","msSaveOrOpenBlob","URL","createObjectURL","download","click","catch","_this$state","percentage","parseInt","handleExport","Dialog","hasCancel","visible","okText","onOk","onCancel","handleCancel","style","paddingLeft","_ref2","options","_moment","_Export","selectListInit","name","QueryCondition","from","to","startDate","startOf","format","endDate","endOf","confidence","glassId","parseGlassIDCSV","handleQuery","Select","selectFirstByDefault","handleSelectChange","DateRangePicker","range","min","minDate","max","maxDate","handleDateChange","handleConfidenceChange","handleGlassIDChange","uniformityOnly","_QueryCondition","GlassList","limit","dataIndex","width","render","record","handleImgClick","status","isLoading","DataTable","columns","Pager","current","perPageCountList","perPageCount","onPageChange","handlePageChange","onPerPageChange","handlePerPageChange","_GlassList","_ImageInfo","unlisten","_this2","history","listen"],"mappings":"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","file":"rejudge.ea613fb1.js","sourcesContent":["import App from './containers/App'\r\nexport default App\r\n","export default {\r\n  F5: 116,\r\n  F6: 117\r\n}\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Button, Input, RadioGroup, Checkbox, confirm, TopTips, PageLoading } from '@tencent/bere'\r\nimport keyCode from '@constant/keyCode'\r\n\r\n// 将数组转化为按钮组所要求list参数格式\r\nfunction radioListInit(arr) {\r\n  return arr.map(value => ({ value, title: value, text: value }))\r\n}\r\n\r\n// REWORK按钮组参数\r\nconst reworkList = [\r\n  { title: 'YES', value: '1', text: 'YES' },\r\n  { title: 'NO', value: '0', text: 'NO' }\r\n]\r\n\r\n// TURN ON按钮组参数\r\nconst turnOnList = [\r\n  { title: 'YES', value: 'T300', text: 'YES' },\r\n  { title: 'NO', value: '', text: 'NO' }\r\n]\r\n\r\n// 是否达到开单标准按钮组参数\r\nconst canBillList = [\r\n  { title: 'YES', value: '1', text: 'YES' },\r\n  { title: 'NO', value: '0', text: 'NO' }\r\n]\r\n\r\n// 将对象字符串转换为可阅读的形式\r\nfunction objFormatting(objStr) {\r\n  if (!objStr) {\r\n    return ''\r\n  }\r\n  const obj = JSON.parse(objStr)\r\n  const list = []\r\n  Object.keys(obj).forEach(key => {\r\n    list.push(key + ':' + obj[key])\r\n  })\r\n  return list.join(' ')\r\n}\r\n\r\n// 将csv字符串解析为codes\r\nfunction parseCodesCSV(string) {\r\n  const rows = string.split('\\n')\r\n  return rows\r\n    .map(row => {\r\n      const cells = row.split(',')\r\n      return cells[0].trim()\r\n    })\r\n    .filter(i => i)\r\n}\r\nclass ImageInfo extends React.Component {\r\n  state = { newCode: '' }\r\n\r\n  // 当前页是否有改动\r\n  get hasChanged() {\r\n    const { imageList, image } = this.props\r\n    const oldImage = imageList.find(item => item.id === image.id)\r\n    const oldResult = oldImage.rejudge_result ? JSON.parse(oldImage.rejudge_result) : {}\r\n    const result = image.rejudge_result\r\n    for (const key in result) {\r\n      if (result[key] != oldResult[key]) {\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('keydown', this.handleKeyDown)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('keydown', this.handleKeyDown)\r\n  }\r\n\r\n  handleKeyDown = e => {\r\n    switch (e.keyCode) {\r\n    case keyCode.F5:\r\n      e.preventDefault()\r\n      this.handlePrev()\r\n      break\r\n    case keyCode.F6:\r\n      e.preventDefault()\r\n      this.handleNext()\r\n      break\r\n    }\r\n  }\r\n\r\n  // 点开大图\r\n  ShowBigImg = () => {\r\n    const { image } = this.props\r\n    const { image_url } = image\r\n    confirm({\r\n      shouldCloseOnOverlayClick: true,\r\n      hasFooter: false,\r\n      className: 'bigImgBoxContainer',\r\n      text: (\r\n        <div className=\"bigImgBox\">\r\n          <img className=\"bigImg\" src={image_url} />\r\n        </div>\r\n      )\r\n    })\r\n  }\r\n\r\n  // 复判\r\n  handleRejudgeChange = key => value =>\r\n    this.props.dispatch({ type: 'rejudge/changeRejudgeResult', payload: { [key]: value } })\r\n\r\n  // 上传CODE\r\n  handleUploadFile = e => {\r\n    const file = e.target.files[0]\r\n    // 清除以便再次上传同一文件\r\n    e.target.value = ''\r\n    if (!file) {\r\n      return\r\n    }\r\n\r\n    const reader = new FileReader()\r\n    reader.onload = e => {\r\n      const codes = parseCodesCSV(reader.result)\r\n      this.props.dispatch({ type: 'rejudge/updateCode', payload: { codes } })\r\n      // 防止内存泄漏\r\n      reader.onload = null\r\n    }\r\n    reader.readAsText(file)\r\n  }\r\n\r\n  // 添加CODE\r\n  handleUpdateCode = () => {\r\n    let { newCode } = this.state\r\n    const { codes } = this.props\r\n    newCode = newCode.trim()\r\n    if (!newCode) {\r\n      return TopTips({ theme: 'error', message: '请输入CODE' })\r\n    } else if (codes.indexOf(newCode) !== -1) {\r\n      return TopTips({ theme: 'error', message: 'CODE重复' })\r\n    }\r\n    this.props.dispatch({ type: 'rejudge/updateCode', payload: { codes: [...codes, newCode] } })\r\n  }\r\n\r\n  // 改变是否显示结果\r\n  handleShowResultChange = showResult =>\r\n    this.props.dispatch({ type: 'rejudge/change', payload: { showResult } })\r\n\r\n  // 改变Input框内容\r\n  handleNewCodeChange = e => this.setState({ newCode: e.target.value })\r\n\r\n  // 提交复判结果\r\n  handleSubmit = () => {\r\n    // 提交完成后返回列表\r\n    this.props.dispatch({\r\n      type: 'rejudge/submitRejudge',\r\n      callback: () => this.handleReturn()\r\n    })\r\n  }\r\n\r\n  // 清空复判数据\r\n  handleClear = () => this.props.dispatch({ type: 'rejudge/clearRejudge' })\r\n\r\n  // 切换图片\r\n  handleNext = () => {\r\n    const { isCodeLoading, isListLoading } = this.props\r\n    if (isCodeLoading || isListLoading) {\r\n      return\r\n    }\r\n\r\n    if (this.hasChanged) {\r\n      // 提交并切换\r\n      this.props.dispatch({\r\n        type: 'rejudge/submitRejudge',\r\n        callback: () => this.props.dispatch({ type: 'rejudge/nextImage' })\r\n      })\r\n    } else {\r\n      // 直接切换\r\n      this.props.dispatch({ type: 'rejudge/nextImage' })\r\n    }\r\n  }\r\n  handlePrev = () => {\r\n    const { isCodeLoading, isListLoading } = this.props\r\n    if (isCodeLoading || isListLoading) {\r\n      return\r\n    }\r\n\r\n    if (this.hasChanged) {\r\n      // 提交并切换\r\n      this.props.dispatch({\r\n        type: 'rejudge/submitRejudge',\r\n        callback: () => this.props.dispatch({ type: 'rejudge/prevImage' })\r\n      })\r\n    } else {\r\n      // 直接切换\r\n      this.props.dispatch({ type: 'rejudge/prevImage' })\r\n    }\r\n  }\r\n\r\n  // 回到image列表\r\n  handleReturn = () =>\r\n    this.props.dispatch({ type: 'rejudge/change', payload: { curTab: 'imageList' } })\r\n\r\n  render() {\r\n    const { newCode } = this.state\r\n    const { image, codes, showResult, isCodeLoading, page, imageList } = this.props\r\n    const {\r\n      image_url,\r\n      image_path,\r\n      image_name,\r\n      adc_result,\r\n      mes_result,\r\n      rejudge_result,\r\n      site,\r\n      shop,\r\n      operation,\r\n      product\r\n    } = image\r\n\r\n    // 计算当页待复判图片数\r\n    const unrejudge = imageList.filter(item => !item.rejudge_result).length\r\n\r\n    return (\r\n      <div className=\"imageInfo tc-panel\">\r\n        <section className=\"yrow\">\r\n          <div className=\"rejudgeData_image fl\">\r\n            <img className=\"img\" src={image_url} alt={image_name} onClick={this.ShowBigImg} />\r\n            <div className=\"rejudge-next\" onClick={this.handleNext} title=\"按F6切换到下一张\">\r\n              {'>'}\r\n            </div>\r\n            <div className=\"rejudge-prev\" onClick={this.handlePrev} title=\"按F5切换到上一张\">\r\n              {'<'}\r\n            </div>\r\n          </div>\r\n          <div className=\"rejudgeData_codes fl\">\r\n            {isCodeLoading ? (\r\n              <PageLoading />\r\n            ) : (\r\n              <React.Fragment>\r\n                <div className=\"code\">\r\n                  <span className=\"title\">选择CODE</span>\r\n                  <span className=\"rejudge-upload tc-15-btn weak\">\r\n                    <input\r\n                      type=\"file\"\r\n                      id=\"rejudge_codeList\"\r\n                      onChange={this.handleUploadFile}\r\n                      accept=\"text/csv\"\r\n                    />\r\n                    <span className=\"weak\">上传CODE</span>\r\n                  </span>\r\n                </div>\r\n                <ul className=\"codeList yrow\">\r\n                  <RadioGroup\r\n                    value={rejudge_result.code}\r\n                    list={radioListInit(codes)}\r\n                    onChange={this.handleRejudgeChange('code')}\r\n                  />\r\n                </ul>\r\n                <div className=\"otherCode\">\r\n                  <span className=\"title\">其他CODE</span>\r\n                  <Input value={newCode} onChange={this.handleNewCodeChange} />\r\n                  <a href=\"javascript:;\" onClick={this.handleUpdateCode}>\r\n                    添加CODE\r\n                  </a>\r\n                </div>\r\n                <ul className=\"\">\r\n                  <li>\r\n                    <span className=\"title\">REWORK</span>\r\n                    <RadioGroup\r\n                      value={rejudge_result.rework}\r\n                      list={reworkList}\r\n                      onChange={this.handleRejudgeChange('rework')}\r\n                    />\r\n                  </li>\r\n                  <li>\r\n                    <span className=\"title\">TURN ON</span>\r\n                    <RadioGroup\r\n                      value={rejudge_result.turn_on}\r\n                      list={turnOnList}\r\n                      onChange={this.handleRejudgeChange('turn_on')}\r\n                    />\r\n                  </li>\r\n                  <li>\r\n                    <span className=\"title\">是否达到开单标准</span>\r\n                    <RadioGroup\r\n                      value={rejudge_result.canBilling}\r\n                      list={canBillList}\r\n                      onChange={this.handleRejudgeChange('canBilling')}\r\n                    />\r\n                  </li>\r\n                </ul>\r\n              </React.Fragment>\r\n            )}\r\n          </div>\r\n        </section>\r\n        <section className=\"RTResult yrow\">\r\n          <div>\r\n            {showResult ? (\r\n              <div>\r\n                <p>\r\n                  ADC：<span>{objFormatting(adc_result)}</span>\r\n                </p>\r\n                <p>\r\n                  MES：<span>{objFormatting(mes_result)}</span>\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              ''\r\n            )}\r\n          </div>\r\n          <div>\r\n            <Checkbox\r\n              checked={showResult}\r\n              label=\"显示ADC与MES判定结果\"\r\n              onChange={this.handleShowResultChange}\r\n            />\r\n          </div>\r\n        </section>\r\n\r\n        <ul className=\"siteInfo yrow\">\r\n          <li>\r\n            <span className=\"title\">厂区</span>\r\n            <span>{site}</span>\r\n          </li>\r\n          <li>\r\n            <span className=\"title\">厂别</span>\r\n            <span>{shop}</span>\r\n          </li>\r\n          <li>\r\n            <span className=\"title\">站点</span>\r\n            <span>{operation}</span>\r\n          </li>\r\n          <li>\r\n            <span className=\"title\">产品</span>\r\n            <span>{product}</span>\r\n          </li>\r\n        </ul>\r\n        <div className=\"tc-action-grid\">\r\n          <div className=\"justify-grid\">\r\n            <div className=\"col\">\r\n              <p className=\"image-list-info\">\r\n                当前为第 {page} 页，本页共 {imageList.length} 张，其中 {unrejudge} 张待复判\r\n              </p>\r\n            </div>\r\n            <div className=\"col\">\r\n              <div className=\"btnBox yrow\">\r\n                <div className=\"fr\">\r\n                  <Button onClick={this.handleSubmit}>确定</Button>\r\n                  <Button className=\"weak\" onClick={this.handleClear}>\r\n                    清空\r\n                  </Button>\r\n                  <Button className=\"weak\" onClick={this.handleReturn}>\r\n                    返回\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default connect(({ rejudge }) => {\r\n  return {\r\n    image: rejudge.image,\r\n    codes: rejudge.codes,\r\n    showResult: rejudge.showResult,\r\n    isCodeLoading: rejudge.isCodeLoading,\r\n    isListLoading: rejudge.isListLoading,\r\n    page: rejudge.page,\r\n    imageList: rejudge.imageList\r\n  }\r\n})(ImageInfo)\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Button, Dialog, TopTips } from '@tencent/bere'\r\nimport classnames from 'classnames'\r\n\r\nfunction toBlob(string, contentType) {\r\n  const buffer = new ArrayBuffer(string.length)\r\n  const array = new Uint8Array(buffer)\r\n  for (let i = 0; i < string.length; i++) {\r\n    array[i] = string.charCodeAt(i)\r\n  }\r\n  return new Blob([buffer], { type: contentType })\r\n}\r\n\r\nlet queue = []\r\n\r\nclass Export extends React.Component {\r\n  state = { total: 0, cur: 0, loading: false, error: false }\r\n\r\n  handleExport = () => {\r\n    const { filters, total } = this.props\r\n    if (!total) {\r\n      return TopTips({ theme: 'error', message: '暂无数据' })\r\n    }\r\n    const pages = Math.ceil(total / 100)\r\n    this.setState({ total: pages || 1, loading: true, error: false })\r\n\r\n    // 初始化任务队列，已有数据的则不改变\r\n    for (let i = 1; i <= pages; i++) {\r\n      if (queue[i - 1] && !(queue[i - 1] instanceof Promise)) {\r\n        continue\r\n      }\r\n      queue[i - 1] = new Promise((resolve, reject) => {\r\n        this.props.dispatch({\r\n          type: 'rejudge/fetchImageList',\r\n          payload: { filters, page: i },\r\n          callback: (err, data) => {\r\n            if (err) return reject(err)\r\n            // 记录进度\r\n            const { cur } = this.state\r\n            this.setState({ cur: cur + 1 })\r\n            queue[i - 1] = data\r\n            resolve(data)\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    Promise.all(queue)\r\n      .then(datas => {\r\n        this.setState({ loading: false, total: 0, cur: 0, error: false })\r\n        // 重置任务队列\r\n        queue = []\r\n        const link = document.createElement('a')\r\n        if (!datas[0] || !datas[0][0]) {\r\n          return TopTips({ theme: 'error', message: '暂无数据' })\r\n        }\r\n        // 转换为 CSV 格式\r\n        const keys = Object.keys(datas[0][0]).join(',')\r\n        const values = []\r\n          .concat(...datas)\r\n          .map(item =>\r\n            Object.values(item)\r\n              .map(item => (item && item.replace ? `\"${item.replace(/\"/g, '\"\"')}\"` : item))\r\n              .join(',')\r\n          )\r\n          .join('\\n')\r\n        const data = keys + '\\n' + values\r\n        // 写入并下载文件\r\n        let file\r\n        try {\r\n          file = toBlob(data, 'text/csv')\r\n        } catch (e) {\r\n          console.log(e)\r\n        }\r\n        if (window.navigator && window.navigator.msSaveOrOpenBlob) {\r\n          window.navigator.msSaveOrOpenBlob(file, 'glass.csv')\r\n        } else {\r\n          link.href = URL.createObjectURL(file)\r\n\r\n          link.download = 'glass.csv'\r\n          link.click()\r\n        }\r\n      })\r\n      .catch(e => {\r\n        this.setState({ error: true })\r\n      })\r\n  }\r\n\r\n  handleCancel = () => this.setState({ loading: false })\r\n\r\n  render() {\r\n    const { total, cur, loading, error } = this.state\r\n    const percentage = parseInt((cur / total) * 100) + '%'\r\n\r\n    return (\r\n      <React.Fragment>\r\n        <Button className=\"update\" onClick={this.handleExport}>\r\n          导出到CSV\r\n        </Button>\r\n        <Dialog\r\n          hasCancel={false}\r\n          hasFooter={error}\r\n          title=\"导出中\"\r\n          visible={loading}\r\n          okText=\"重试\"\r\n          onOk={this.handleExport}\r\n          onCancel={this.handleCancel}\r\n        >\r\n          <div\r\n            className={classnames('export-progress', { error })}\r\n            style={{ paddingLeft: percentage }}\r\n          />\r\n          <div className=\"export-percentage\">{percentage}</div>\r\n        </Dialog>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n}\r\n\r\nexport default connect(({ rejudge }) => {\r\n  return {\r\n    filters: rejudge.filters,\r\n    options: rejudge.options,\r\n    total: rejudge.total\r\n  }\r\n})(Export)\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { Select, Button, DateRangePicker, Checkbox, Input, TopTips } from '@tencent/bere'\r\nimport moment from 'moment'\r\nimport Export from './Export'\r\n\r\nfunction selectListInit(array) {\r\n  return array.map(name => ({ text: name, value: name }))\r\n}\r\n\r\n// 将csv字符串解析为glassID\r\nfunction parseGlassIDCSV(string) {\r\n  const rows = string.split('\\n')\r\n  return rows\r\n    .map(row => {\r\n      const cells = row.split(',')\r\n      return cells[0].trim()\r\n    })\r\n    .filter(i => i)\r\n}\r\n\r\nclass QueryCondition extends React.Component {\r\n  // 改变查询条件\r\n  handleSelectChange = key => value =>\r\n    this.props.dispatch({ type: 'rejudge/changeFilter', payload: { [key]: value } })\r\n\r\n  // 改变起止时间\r\n  handleDateChange = ({ from, to }) =>\r\n    this.props.dispatch({\r\n      type: 'rejudge/changeFilter',\r\n      payload: {\r\n        startDate: moment(from)\r\n          .startOf('day')\r\n          .format('YYYY-MM-DD HH:mm:ss'),\r\n        endDate: moment(to)\r\n          .endOf('day')\r\n          .format('YYYY-MM-DD HH:mm:ss')\r\n      }\r\n    })\r\n\r\n  // 改变置信度\r\n  handleConfidenceChange = e => {\r\n    const { value } = e.target\r\n    const confidence = parseInt(value) || 0\r\n    this.props.dispatch({ type: 'rejudge/changeFilter', payload: { confidence } })\r\n  }\r\n\r\n  // 上传 glass id 列表\r\n  handleGlassIDChange = e => {\r\n    const file = e.target.files[0]\r\n    // 清除以便再次上传同一文件\r\n    e.target.value = ''\r\n    if (!file) {\r\n      return\r\n    }\r\n\r\n    const reader = new FileReader()\r\n    reader.onload = e => {\r\n      const glassId = parseGlassIDCSV(reader.result)\r\n      this.props.dispatch({ type: 'rejudge/changeFilter', payload: { glassId } })\r\n      this.handleQuery()\r\n      // 防止内存泄漏\r\n      reader.onload = null\r\n    }\r\n    reader.readAsText(file)\r\n  }\r\n\r\n  // 清空查询条件，但不立即查询\r\n  handleClear = () => this.props.dispatch({ type: 'rejudge/clearFilter' })\r\n\r\n  // 使用当前查询条件查询\r\n  handleQuery = () => this.props.dispatch({ type: 'rejudge/fetchCurImageList' })\r\n\r\n  render() {\r\n    const { filters, options } = this.props\r\n    return (\r\n      <div className=\"queryCondition tc-panel\">\r\n        <ul className=\"condition condition1 yrow\">\r\n          <li>\r\n            <div className=\"condition-select-container\">\r\n              <span className=\"title\">厂区</span>\r\n              <Select\r\n                value={filters.site}\r\n                selectFirstByDefault\r\n                list={selectListInit(options.site)}\r\n                onChange={this.handleSelectChange('site')}\r\n              />\r\n            </div>\r\n          </li>\r\n          <li>\r\n            <div className=\"condition-select-container\">\r\n              <span className=\"title\">厂别</span>\r\n              <Select\r\n                value={filters.shop}\r\n                selectFirstByDefault\r\n                list={selectListInit(options.shop)}\r\n                onChange={this.handleSelectChange('shop')}\r\n              />\r\n            </div>\r\n          </li>\r\n          <li>\r\n            <div className=\"condition-select-container\">\r\n              <span className=\"title\">站点</span>\r\n              <Select\r\n                value={filters.operation}\r\n                selectFirstByDefault\r\n                list={selectListInit(options.operation)}\r\n                onChange={this.handleSelectChange('operation')}\r\n              />\r\n            </div>\r\n          </li>\r\n          <li>\r\n            <div className=\"condition-select-container\">\r\n              <span className=\"title\">产品</span>\r\n              <Select\r\n                value={filters.product}\r\n                selectFirstByDefault\r\n                list={selectListInit(options.product)}\r\n                onChange={this.handleSelectChange('product')}\r\n              />\r\n            </div>\r\n          </li>\r\n        </ul>\r\n        <ul className=\"condition condition2 yrow\">\r\n          <li>\r\n            <span className=\"title\">起止时间</span>\r\n            <DateRangePicker\r\n              value={{ from: filters.startDate, to: filters.endDate }}\r\n              range={{ min: options.minDate, max: options.maxDate }}\r\n              onChange={this.handleDateChange}\r\n            />\r\n          </li>\r\n          <li>\r\n            <span className=\"title\">置信度</span>\r\n            <Input value={filters.confidence} onChange={this.handleConfidenceChange} />\r\n          </li>\r\n          <li>\r\n            <div className=\"rejudge-upload\">\r\n              <input type=\"file\" accept=\"text/csv\" onChange={this.handleGlassIDChange} />\r\n              <Button className=\"update\">上传glass ID表</Button>\r\n            </div>\r\n          </li>\r\n          <li>\r\n            <Checkbox\r\n              checked={filters.uniformityOnly}\r\n              label=\"仅显示判定结果不一致\"\r\n              onChange={this.handleSelectChange('uniformityOnly')}\r\n            />\r\n          </li>\r\n          <li>\r\n            <Export />\r\n          </li>\r\n          <li className=\"fr btnBox\">\r\n            <Button onClick={this.handleQuery}>查询</Button>\r\n            <Button className=\"weak\" onClick={this.handleClear}>\r\n              清空\r\n            </Button>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default connect(({ rejudge }) => {\r\n  return {\r\n    filters: rejudge.filters,\r\n    options: rejudge.options\r\n  }\r\n})(QueryCondition)\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\nimport { DataTable, Pager } from '@tencent/bere'\r\nimport QueryCondition from './QueryCondition'\r\n\r\nclass GlassList extends React.Component {\r\n  // 改变页数\r\n  handlePageChange = page =>\r\n    this.props.dispatch({ type: 'rejudge/changePage', payload: { page: page + 1 } })\r\n\r\n  // 改变每页条目数\r\n  handlePerPageChange = limit =>\r\n    this.props.dispatch({ type: 'rejudge/changePerPage', payload: { limit } })\r\n\r\n  // 进入复判页面\r\n  handleImgClick = id => () => {\r\n    const { list } = this.props\r\n    const image = list.find(item => item.id === id)\r\n    this.props.dispatch({ type: 'rejudge/startRejudge', payload: { ...image } })\r\n  }\r\n\r\n  columns = [\r\n    { key: 'glass_id', dataIndex: 'glass_id', title: 'glass id', width: 200 },\r\n    {\r\n      key: 'image_name',\r\n      dataIndex: 'image_name',\r\n      title: 'imgage 名称',\r\n      render: (value, record) => (\r\n        <div className=\"text-overflow\">\r\n          <a href=\"javascript:;\" title={value} onClick={this.handleImgClick(record.id)}>\r\n            {value}\r\n          </a>\r\n        </div>\r\n      )\r\n    },\r\n    { key: 'confidence_level', dataIndex: 'confidence_level', title: '置信度' },\r\n    {\r\n      key: 'rejudge_result',\r\n      dataIndex: 'rejudge_result',\r\n      title: '是否完成复判',\r\n      width: 200,\r\n      render: value => {\r\n        const status = value ? 'succeed' : 'warning'\r\n        const text = value ? '是' : '否'\r\n        return <div className={`text-overflow ${status}`}>{text}</div>\r\n      }\r\n    }\r\n  ]\r\n\r\n  render() {\r\n    const { page, limit, total, list, isLoading } = this.props\r\n    return (\r\n      <div className=\"manage-area-main-inner\">\r\n        <QueryCondition />\r\n        <div className=\"tc-panel panel-table\">\r\n          <DataTable columns={this.columns} data={list} loading={isLoading} />\r\n          <Pager\r\n            total={total}\r\n            current={page - 1}\r\n            perPageCountList={[15, 30, 45]}\r\n            perPageCount={limit}\r\n            onPageChange={this.handlePageChange}\r\n            onPerPageChange={this.handlePerPageChange}\r\n          />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default connect(({ rejudge }) => {\r\n  return {\r\n    list: rejudge.imageList,\r\n    page: rejudge.page,\r\n    limit: rejudge.limit,\r\n    total: rejudge.total,\r\n    isLoading: rejudge.isListLoading\r\n  }\r\n})(GlassList)\r\n","import React from 'react'\r\nimport { connect } from 'react-redux'\r\n\r\nimport GlassList from './GlassList'\r\nimport ImageInfo from './ImageInfo'\r\n\r\nclass App extends React.Component {\r\n  state = { unlisten: () => null }\r\n\r\n  componentDidMount() {\r\n    this.props.dispatch({ type: 'rejudge/initialize' })\r\n    this.props.dispatch({\r\n      type: 'rejudge/fetchFilterOptions',\r\n      callback: options => {\r\n        // 由于以下几个字段为默认选中第一项，不会触发 onChange，所以需要手动设置\r\n        const { site, shop, operation, product } = options\r\n        this.props.dispatch({\r\n          type: 'rejudge/changeFilter',\r\n          payload: {\r\n            site: site[0],\r\n            shop: shop[0],\r\n            operation: operation[0],\r\n            product: product[0]\r\n          }\r\n        })\r\n        this.props.dispatch({ type: 'rejudge/fetchCurImageList' })\r\n      }\r\n    })\r\n    // 用户点击菜单时重置页面\r\n    const unlisten = this.props.history.listen(() => {\r\n      this.props.dispatch({ type: 'rejudge/initialize' })\r\n    })\r\n    this.setState({ unlisten })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.state.unlisten()\r\n  }\r\n\r\n  render() {\r\n    const { curTab } = this.props\r\n\r\n    return (\r\n      <div className=\"rejudge main adc-manage-main\">\r\n        <div className=\"manage-area\">\r\n          <div className=\"manage-area-title\">\r\n            <h2>复判工具</h2>\r\n          </div>\r\n          <div className=\"manage-area-main\">\r\n            {curTab === 'imageList' ? <GlassList /> : <ImageInfo />}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default connect(({ rejudge }) => {\r\n  return { curTab: rejudge.curTab }\r\n})(App)\r\n"],"sourceRoot":""}